name: DEPLOY

on:
    push:
        branches: release
jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Install Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: '14'

            - name: Install dependencies
              run: npm install

            - name: Build Angular app
              run: npm run build --prod

            - name: Deploy to EC2
              uses: easingthemes/ssh-deploy@v2
              with:
                  SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
                  SOURCE: 'dist/mediumclone_angular/'
                  REMOTE_HOST: 'ec2-13-48-56-99.eu-north-1.compute.amazonaws.com'
                  REMOTE_USER: 'ubuntu'
                  TARGET: '/var/www/html/mediumclone-angular/dist/mediumclone_angular'
